---
- name: 2.3.1.1 (L1) Ensure 'Accounts':' Administrator account status' is set to 'Disabled' (MS only) (Scored)
  win_security_policy:
    section: System Access
    key: EnableAdminAccount
    value: 0
  when: not datacenter|bool

- name: 2.3.1.2 (L1) Ensure 'Accounts':' Block Microsoft accounts' is set to 'Users can't add or log on with Microsoft accounts' (Scored) 
  win_regedit:
    path: 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System'
    name: NoConnectedUser
    data: 3
    type: dword
    state: present

- name: 2.3.1.3 (L1) Ensure 'Accounts':' Guest account status' is set to 'Disabled' (MS only) (Scored) 
  win_security_policy:
    section: System Access
    key: EnableGuestAccount
    value: 0
  when: not datacenter|bool

- name: 2.3.1.4 (L1) Ensure 'Accounts, Limit local account use of blank passwords to console logon only' is set to 'Enabled' (Scored) 
  win_regedit:
    path: 'HKLM:\System\CurrentControlSet\Control\LSA'
    name: LimitBlankPasswordUse
    data: 1
    type: dword
    state: present

- name: "2.3.1.6 (L1) Configure 'Accounts: Rename administrator account' (Scored)"
  win_security_policy:
    section: System Access
    key: NewGuestName
    value: "notGuest"

- name: 2.3.2.1 (L1) Ensure 'Audit":" Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings' is set to 'Enabled' (Scored)
  win_regedit:
    path: 'HKLM:\System\CurrentControlSet\Control\LSA'
    name: SCENoApplyLegacyAuditPolicy
    data: 1
    type: dword
    state: present

- name: 2.3.2.2 (L1) Ensure 'Audit":"" Shut down system immediately if unable tolog security audits' is set to 'Disabled' (Scored)
  win_regedit:
    path: 'HKLM:\System\CurrentControlSet\Control\LSA'
    name: CrashOnAuditFail
    data: 0
    type: dword
    state: present

- name: 2.3.4.1 (L1) Ensure 'Devices":"" Allowed to format and eject removable media' is set to 'Administrators' (Scored) 
  win_regedit:
    path: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
    name: AllocateDASD
    data: 0
    type: dword
    state: present

